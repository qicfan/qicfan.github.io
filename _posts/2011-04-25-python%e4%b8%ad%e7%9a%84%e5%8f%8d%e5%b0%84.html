---
layout: post
title: python中的反射
tags:
- globals()
- python
- python反射
- 反射
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  views: '313'
---
在用php的时候，我们经常会出现这样的调用
<pre class="brush:[php]">class obj {
    function __contruct() {
        return true;
    }
}

$a = "obj";

$obj  = new $a();</pre>
php中的这种用法确实很方便，在python中也提供了这样的一种反射机制：<strong>globals()</strong>
以下摘自：<a href="http://blog.csdn.net/lokibalder/archive/2008/12/06/3459722.aspx"> python中的反射和自省</a>
globals()函数返回一个map,这个map的key是全局范围内对象的名字，value是该对象的实例
在不导入任何module下，执行globals（）的结果如下：
<pre class="brush:[python]">&gt;&gt;&gt; globals()
{'__builtins__': , '__name__': '__main__', '__doc__': None, '__package__': None}</pre>
在导入sgmllib，如下:
<pre class="brush:[python]">&gt;&gt;&gt; globals()
{'__builtins__': &lt;module '__builtin__' (built-in)&gt;, '__name__': '__main__', 'sgmllib': &lt;module 'sgmllib' from 'D:\Program Files\Python26\lib\sgmllib.pyc'&gt;, '__doc__': None, '__package__': None}</pre>
如果导入类后，在map中，可以找到类:
<pre class="brush:[python]">&gt;&gt;&gt; from sgmllib import SGMLParser
&gt;&gt;&gt; globals()
{'sgmllib': &lt;module 'sgmllib' from 'D:\Program Files\Python26\lib\sgmllib.pyc'&gt;, 'SGMLParser': &lt;class sgmllib.SGMLParser at 0x01BA0F90&gt;, '__builtins__': &lt;module '__builtin__' (built-in)&gt;, '__package__': None, '__name__': '__main__', '__doc__': None}</pre>
所以，只要将class的名字最为key，即可得到class。如下：
<pre class="brush:[python]">&gt;&gt;&gt; globals()['SGMLParser']
&lt;class sgmllib.SGMLParser at 0x01BA0F90&gt;</pre>
我们在使用中，只需要这样来使用globals()方法即可实现与PHP中类似的效果（通俗说从字符串变量中实例化对象），即JAVA中的反射机制：
<pre class="brush:[python]">class obj:
    def __init__(self, str):
        print str

var = 'obj'
# 通过变量var实例化对象obj
instance = globals()[var]
&gt;&gt;&gt; instance
&lt;class __main__.obj at 0x01BA0AE0&gt;</pre>
